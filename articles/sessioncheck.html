<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>sessioncheck • sessioncheck</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="sessioncheck">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sessioncheck</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/sessioncheck.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/why-check-the-r-session.html">Why is it important to check the R session?</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/djnavarro/sessioncheck/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>sessioncheck</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/djnavarro/sessioncheck/blob/main/vignettes/sessioncheck.Rmd" class="external-link"><code>vignettes/sessioncheck.Rmd</code></a></small>
      <div class="d-none name"><code>sessioncheck.Rmd</code></div>
    </div>

    
    
<p>The goal of <strong>sessioncheck</strong> is to provide simple tools
that can be called at the top of a script, and produce warnings or
errors if it detects signs that the script is not being executed in a
clean R session. The intended user for <strong>sessioncheck</strong> is
a beginner or intermediate level R user who has learned enough about R
to understand the limitations of using <code>rm(list = ls())</code> as a
method to clean the R session, but is perhaps not at the point that they
can take advantage of sophisticated tools like <a href="https://books.ropensci.org/targets/" class="external-link">targets</a>, <a href="https://callr.r-lib.org/" class="external-link">callr</a>, and so on.</p>
<div class="section level2">
<h2 id="why-is-this-important">Why is this important?<a class="anchor" aria-label="anchor" href="#why-is-this-important"></a>
</h2>
<p>A common practice when writing R scripts is to include a snippet of
code like <code>rm(list = ls())</code> at the top of the script. The
reason people do this is for reproducibility purposes, to ensure that
the script is run in the context of a “clean” R session. The goal is a
good one, but the method used to attain it is not very effective. The
only thing that <code>rm(list = ls())</code> does is remove any
variables currently stored in the global environment, but this is only
one of many different ways in which previously-executed code can alter
the state of the R session. This approach doesn’t provide any degree of
safety from any of the following:</p>
<ul>
<li>packages that may have been loaded with <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> and
change which functions get executed by your code</li>
<li>data sets or other environments that may have been added to the
search path with <code><a href="https://rdrr.io/r/base/attach.html" class="external-link">attach()</a></code> and alter the variables and
functions that are visible to your code</li>
<li>options that may have been set with <code><a href="https://rdrr.io/r/base/options.html" class="external-link">options()</a></code> and can
alter how your code is interpreted</li>
<li>“hidden” variables in the global environment like
<code>.Random.seed</code> that affect R code execution and are ignored
by <code>rm(list = ls())</code>
</li>
<li>…and many more; there’s a long list of subtler ways in which the R
session state matters</li>
</ul>
<p>Any of these can affect how your script executes, and
<code>rm(list = ls())</code> does not protect you against any of them.
Because of this, a better practice is to <strong>restart the R
session</strong> immediately before running the script. By running the
script in a fresh R session, you’re much less likely to encounter these
issues. By exension, the reason for including a call to
<code><a href="../reference/sessioncheck.html">sessioncheck()</a></code> at the top of a script is to <strong>prompt
the user</strong> when potential issues are detected.</p>
<p>For additional background see the article on <a href="https://sessioncheck.djnavarro.net/articles/why-check-the-r-session.html">why
session checking is useful</a>.</p>
</div>
<div class="section level2">
<h2 id="how-does-sessioncheck-work">How does sessioncheck work?<a class="anchor" aria-label="anchor" href="#how-does-sessioncheck-work"></a>
</h2>
<p>The <strong>sessioncheck</strong> package is built on several
functions that each check one specific aspect to the R session: the
<code><a href="../reference/sessioncheck.html">sessioncheck()</a></code> function itself merely aggregates the
results of the individual checks.</p>
<p>When calling <code><a href="../reference/sessioncheck.html">sessioncheck()</a></code> you can customise exactly
which checks are performed and what rules should apply to each check,
but for now let’s look at the three specific checks that are performed
by default: checks of the global environment, checks of the attached
packages, and checks of the attached non-package environments. These can
be run as standalone checks using <code><a href="../reference/object_checks.html">check_globalenv()</a></code>,
<code><a href="../reference/package_checks.html">check_packages()</a></code> and <code><a href="../reference/object_checks.html">check_attachments()</a></code>, so
the natural place to start is examining the behaviour of the standalone
checks.</p>
<div class="section level3">
<h3 id="check-1-global-environment">Check 1: global environment<a class="anchor" aria-label="anchor" href="#check-1-global-environment"></a>
</h3>
<p>The first and simplest of the checks is
<code><a href="../reference/object_checks.html">check_globalenv()</a></code>, and it focuses on the same aspect of the
R session that the traditional <code>rm(list=ls())</code> method does:
the contents of the global environment. At the moment there is nothing
in the global environment, so it is considered “clean”. As a
consequence, nothing happens when we run this check:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sessioncheck</span><span class="fu">::</span><span class="fu"><a href="../reference/object_checks.html">check_globalenv</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>To get the check to produce a warning, we’ll need to add some
variables:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">visible_1</span> <span class="op">&lt;-</span> <span class="st">"this will get detected"</span></span>
<span><span class="va">visible_2</span> <span class="op">&lt;-</span> <span class="st">"so will this"</span></span>
<span><span class="va">.hidden_1</span> <span class="op">&lt;-</span> <span class="st">"but this will not"</span></span>
<span></span>
<span><span class="fu">sessioncheck</span><span class="fu">::</span><span class="fu"><a href="../reference/object_checks.html">check_globalenv</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Detected objects: visible_1, visible_2</span></span></code></pre></div>
<p>The output indicates that the script has detected
<code>visible_1</code> and <code>visible_2</code> in the global
environment, and issues a warning to suggest that the R session may be
contaminated.</p>
<p>There are two arguments to <code><a href="../reference/object_checks.html">check_globalenv()</a></code>:</p>
<ul>
<li>
<code>action</code> specifies what the function should do if an
issue is detected. There are four allowed values: <code>error</code>,
<code>warn</code> (the default), <code>message</code>, and
<code>none</code>.</li>
<li>
<code>allow</code> is a character vector used to specify the rules
that are used to decide <em>which</em> objects should trigger an action.
A variable name that is included in the <code>allow</code> list will not
trigger an action. There is a special case: <code>allow = NULL</code>
will apply the same rule that <code><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls()</a></code> uses when listing the
contents of the global environment: variables that start with a
<code>.</code> will be ignored, and will not trigger an action.</li>
</ul>
<p>The example below illustrates how both of these actions are used.
Here, the action taken will be to print a message rather than a warning;
and by setting the <code>allow</code> argument to an empty string,
<em>any</em> variable in the global environment will trigger the
message, even the “hidden” ones:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sessioncheck</span><span class="fu">::</span><span class="fu"><a href="../reference/object_checks.html">check_globalenv</a></span><span class="op">(</span>action <span class="op">=</span> <span class="st">"message"</span>, allow <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#&gt; Detected objects: .hidden_1, .Random.seed, visible_1, visible_2</span></span></code></pre></div>
<p>This time we notice that the check detects the <code>visible_1</code>
and <code>visible_2</code> like last time, but it now detects two hidden
variables: the <code>.hidden_1</code> variable that I created earlier,
and also the <code>.Random.seed</code> variable that R uses to store the
state of the random number generator.</p>
</div>
<div class="section level3">
<h3 id="check-2-attached-packages">Check 2: attached packages<a class="anchor" aria-label="anchor" href="#check-2-attached-packages"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sessioncheck</span><span class="fu">::</span><span class="fu"><a href="../reference/package_checks.html">check_packages</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The warning notes that the <strong>sessioncheck</strong> package has
been attached. This might be considered acceptable, so we can ask the
check to <code>allow</code> this package:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sessioncheck</span><span class="fu">::</span><span class="fu"><a href="../reference/package_checks.html">check_packages</a></span><span class="op">(</span>action <span class="op">=</span> <span class="st">"warn"</span>, allow <span class="op">=</span> <span class="st">"sessioncheck"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="check-3-other-attachments">Check 3: other attachments<a class="anchor" aria-label="anchor" href="#check-3-other-attachments"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sessioncheck</span><span class="fu">::</span><span class="fu"><a href="../reference/object_checks.html">check_attachments</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="other-checks">Other checks<a class="anchor" aria-label="anchor" href="#other-checks"></a>
</h3>
<p>There are other checks that are not called by default. One is an
“allow list” check, where the user must specify exactly which entities
are permitted (i.e. the list of things that <em>don’t</em> trigger an
action):</p>
<ul>
<li>
<code><a href="../reference/package_checks.html">check_namespaces()</a></code> looks for packages that have been
loaded but not attached</li>
</ul>
<p>The others are “block list” checks, where the user specifies which
cases are to be blocked (i.e., the list of things that <em>do</em>
trigger an action)</p>
<ul>
<li>TODO: <code><a href="../reference/value_checks.html">check_options()</a></code> looks for specific options that
might be of concern</li>
<li>TODO: <code><a href="../reference/value_checks.html">check_sysenv()</a></code> looks for system environment
variables</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Danielle Navarro.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
