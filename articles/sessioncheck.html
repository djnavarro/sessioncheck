<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>sessioncheck • sessioncheck</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="sessioncheck">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sessioncheck</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/sessioncheck.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/djnavarro/sessioncheck/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>sessioncheck</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/djnavarro/sessioncheck/blob/main/vignettes/sessioncheck.Rmd" class="external-link"><code>vignettes/sessioncheck.Rmd</code></a></small>
      <div class="d-none name"><code>sessioncheck.Rmd</code></div>
    </div>

    
    
<p>The goal of <strong>sessioncheck</strong> is to provide simple tools
that can be called at the top of a script, and produce warnings or
errors if it detects signs that the script is not being executed in a
clean R session. The intended user for <strong>sessioncheck</strong> is
a beginner or intermediate level R user who has learned enough about R
to understand the limitations of using <code>rm(list = ls())</code> as a
method to clean the R session, but is perhaps not at the point that they
can take advantage of sophisticated tools like <a href="https://books.ropensci.org/targets/" class="external-link">targets</a>, <a href="https://callr.r-lib.org/" class="external-link">callr</a>, and so on.</p>
<div class="section level2">
<h2 id="why-is-this-important">Why is this important?<a class="anchor" aria-label="anchor" href="#why-is-this-important"></a>
</h2>
<p>A common practice when writing R scripts is to include a snippet of
code like <code>rm(list = ls())</code> at the top of the script. The
reason people do this is for reproducibility purposes, to ensure that
the script is run in the context of a “clean” R session. The goal is a
good one, but the method used to attain it is not very effective. The
only thing that <code>rm(list = ls())</code> does is remove any
variables currently stored in the global environment, but this is only
one of many different ways in which previously-executed code can alter
the state of the R session. This approach doesn’t provide any degree of
safety from any of the following:</p>
<ul>
<li>packages may have been loaded with <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code>
</li>
<li>data sets may have been added to the search path with
<code><a href="https://rdrr.io/r/base/attach.html" class="external-link">attach()</a></code>
</li>
<li>options may have been set with <code><a href="https://rdrr.io/r/base/options.html" class="external-link">options()</a></code>
</li>
<li>“hidden” variables in the global environment like
<code>.Random.seed</code>
</li>
<li>(…and a long list of other more subtle things)</li>
</ul>
<p>Any of these can affect how your script executes, and
<code>rm(list = ls())</code> does not protect you against any of them.
Because of this, a better practice is to <strong>restart the R
session</strong> immediately before running the script. By running the
script in a fresh R session, you’re much less likely to encounter these
issues.</p>
</div>
<div class="section level2">
<h2 id="how-does-sessioncheck-help">How does sessioncheck help?<a class="anchor" aria-label="anchor" href="#how-does-sessioncheck-help"></a>
</h2>
<p>The principle that underpins <strong>sessioncheck</strong> is that
scripts should not attempt a “clean up” of the environment. A better
approach is to include a snippet of code that inspects the state of the
R session, and produces a warning (or even an error) if it detects signs
that the script is not being run in a clean session. The simplest way to
do this is with the <code><a href="../reference/check_session.html">check_session()</a></code> function. The user
could put this as the very line of their R script:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sessioncheck</span><span class="fu">::</span><span class="fu"><a href="../reference/check_session.html">check_session</a></span><span class="op">(</span><span class="st">"error"</span><span class="op">)</span></span></code></pre></div>
<p>When executed in a clean R session this function does nothing, and
the script will continue to run as it normally would. However, if the
session is “dirty” – for some specific interpretation of what that means
– it will produce an error, prevent the script from running, and prompt
the user to consider restarting the R session.</p>
<p>This intended behaviour is very easy to illustrate in this vignette,
because the environment inside the R markdown document has been altered
in many ways that make it different from a “typical” clean R session.
Here is an example showing the error that a user might see if they run a
“session checked” script in a dirty R session:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sessioncheck</span><span class="fu">::</span><span class="fu"><a href="../reference/check_session.html">check_session</a></span><span class="op">(</span><span class="st">"error"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Session check detected the following issues:</span></span>
<span><span class="co">#&gt; - Attached non-package environments: tools:callr</span></span>
<span><span class="co">#&gt; It may be necessary to restart R</span></span></code></pre></div>
<p>The error message lists two specific problems:</p>
<ul>
<li>several “unapproved” packages have been loaded via namespace</li>
<li>one “unapproved” environment has been appended to the search
path</li>
</ul>
<p>This is then followed by a prompt for the user to restart R.</p>
</div>
<div class="section level2">
<h2 id="how-does-sessioncheck-work">How does sessioncheck work?<a class="anchor" aria-label="anchor" href="#how-does-sessioncheck-work"></a>
</h2>
<p>The <strong>sessioncheck</strong> package is built on several
functions that each check one specific aspect to the R session: the
<code><a href="../reference/check_session.html">check_session()</a></code> function itself merely aggregates the
results of the individual checks. When calling
<code><a href="../reference/check_session.html">check_session()</a></code> you can customise exactly which checks are
performed and what rules should apply to each check, but for now let’s
look at what the individual check functions do. Let’s load the package
first, so that we can explore the behaviour of the check functions one
at a time:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/djnavarro/sessioncheck" class="external-link">sessioncheck</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="check-the-global-environment">Check the global environment<a class="anchor" aria-label="anchor" href="#check-the-global-environment"></a>
</h3>
<p>The first and simplest of the checks is
<code><a href="../reference/sessionchecks.html">check_globalenv()</a></code>, and it focuses on the same aspect of the
R session that the traditional <code>rm(list=ls())</code> method does:
the contents of the global environment. At the moment there is nothing
in the global environment, so it is considered “clean”. As a
consequence, nothing happens when we run this check:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sessionchecks.html">check_globalenv</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>To get the check to produce a warning, we’ll need to add some
variables:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">visible_1</span> <span class="op">&lt;-</span> <span class="st">"this will get detected"</span></span>
<span><span class="va">visible_2</span> <span class="op">&lt;-</span> <span class="st">"so will this"</span></span>
<span><span class="va">.hidden_1</span> <span class="op">&lt;-</span> <span class="st">"but this will not"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/sessionchecks.html">check_globalenv</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Detected objects: visible_1, visible_2</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="check-the-attached-packages">Check the attached packages<a class="anchor" aria-label="anchor" href="#check-the-attached-packages"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sessionchecks.html">check_packages</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Detected attached packages: sessioncheck</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="check-for-other-attached-environments">Check for other attached environments<a class="anchor" aria-label="anchor" href="#check-for-other-attached-environments"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sessionchecks.html">check_attachments</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Detected attached environments: tools:callr</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="check-loaded-namespaces">Check loaded namespaces<a class="anchor" aria-label="anchor" href="#check-loaded-namespaces"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sessionchecks.html">check_namespaces</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Dectected loaded namespaces: digest, desc, R6, fastmap, and 19 more</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Danielle Navarro.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
